<script src="{{ '/assets/js/lunr_2.js' | relative_url }}"></script>
<script>
{% assign counter = 0 %}
var documents = [
  {% for page in site.pages %}
    {% if page.url contains '.xml' or page.url contains 'assets' %}
    {% else %}{
      "id": {{ counter }},
      "url": "{{ site.url }}{{ page.url }}",
      "title": "{{ page.title | default: page.name }}",
      "body": "{{ page.content | markdownify | replace: '.', '. ' | replace: '</h2>', ': ' | replace: '</h3>', ': ' | replace: '</h4>', ': ' | replace: '</p>', ' ' | strip_html | strip_newlines | replace: '  ', ' ' | replace: '"', ' ' }}"{% assign counter = counter | plus: 1 %}
    },
    {% endif %}
  {% endfor %}
];

var idx = lunr(function () {
  this.ref('id');
  this.field('title');
  this.field('body');
  documents.forEach(function (doc) {
    this.add(doc);
  }, this);
});

function lunr_search(term) {
  var container = document.getElementById('lunrsearchresults');
  container.innerHTML = '';
  if (!term) {
    container.innerHTML = '<div class="search-empty">Informe um termo para buscar.</div>';
    return;
  }
  var results = idx.search(term);
  if (results.length > 0) {
    var html = '<ul class="search-results">';
    for (var i = 0; i < results.length; i++) {
      var ref = results[i]['ref'];
      var url = documents[ref]['url'];
      var title = documents[ref]['title'];
      var body = documents[ref]['body'].substring(0, 180) + '...';
      html += '<li class="result-item"><a href="' + url + '">' + title + '</a><p>' + body + '</p></li>';
    }
    html += '</ul>';
    container.innerHTML = html;
  } else {
    container.innerHTML = '<div class="search-empty">Nenhum resultado encontrado para "' + term + '".</div>';
  }
}
</script>
